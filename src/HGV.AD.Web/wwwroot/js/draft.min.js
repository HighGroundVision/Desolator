function DraftingViewModel(){var n=this;n.AvailableDraft=ko.observableArray();n.SelectedDraft=ko.observableArray();n.FilteredDraft=ko.observableArray();n.SearchDraft=ko.observable();n.SelectedHeroes=ko.observableArray();n.AvailableAbilities=ko.observableArray();n.Combos=ko.observableArray();n.SelectedHero=ko.observable(null);n.SelectedAbility=ko.observable(null);n.Searching=ko.observable(!1);n.FilteredDraft=ko.computed(function(){var i=n.SearchDraft(),r,t;if(i)if(r=i.toLowerCase(),t=ko.utils.arrayFilter(n.AvailableDraft(),function(n){var t=n.identity.replace("_"," ");return t.includes(r)}),t.length==1)n.SelectDraft(t[0]);else return t;return n.AvailableDraft()});n.FilteredAbilities=ko.computed(function(){return ko.utils.arrayFilter(n.AvailableAbilities(),function(n){return n.ultimate===!1})});n.FilteredUltimateAbilities=ko.computed(function(){return ko.utils.arrayFilter(n.AvailableAbilities(),function(n){return n.ultimate===!0})});n.GetSelectedHeroStyling=function(t){var i=ko.utils.arrayFirst(n.SelectedDraft(),function(n){return n.id==t.id});return i?"selected-img":""};n.GetHeroRankStyling=function(n){return n.percentage<.2?"progress-bar progress-bar-danger":n.percentage>.8?"progress-bar progress-bar-success":"progress-bar progress-bar-primary"};n.SelectDraft=function(t){var i,r,u;n.SearchDraft("");i=ko.utils.arrayFirst(n.SelectedDraft(),function(n){return n.id==t.id});i?(n.SelectedDraft.remove(t),r=ko.utils.arrayFirst(n.SelectedHeroes(),function(n){return n.id==t.heroId}),n.SelectedHeroes.remove(r),u=ko.utils.arrayFilter(n.AvailableAbilities(),function(n){return n.heroId===t.heroId}),n.AvailableAbilities.removeAll(u)):(n.SelectedDraft.push(t),$.get("/Draft/GetHeroSummary/"+t.heroId).done(function(t){n.SelectedHeroes.push(t)}),$.get("/Draft/GetHeroesAbilities/"+t.heroId).done(function(t){$.each(t,function(t,i){n.AvailableAbilities.push(i);n.IfDraftIsFullThenGetCombos()})}))};n.IfDraftIsFullThenGetCombos=function(){var t,i;n.SelectedDraft().length==12&&n.AvailableAbilities().length==48&&(n.Searching(!0),t=$.map(n.SelectedDraft(),function(n){return n.id}),new Clipboard("#share-draft",{text:function(){return window.location.origin+window.location.pathname+"?key="+t}}),i=$.map(n.AvailableAbilities(),function(n){return n.id}),$.post("/Draft/GetCombosFromPool/",{abilities:i}).done(function(t){n.Searching(!1);n.Combos(t);$("#tblCombos").DataTable({destroy:!0,scrollX:!0,order:[[4,"desc"]],pagingType:"simple",pageLength:25,dom:"<'row'<'col-sm-6'i><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-6'l><'col-sm-6'p>>"})}))};n.SelectHero=function(t){if(n.SelectedDraft().length==12){var i=$.map(n.AvailableAbilities(),function(n){return n.id});$.post("/Draft/GetHeroDetails/"+t.id,{abilities:i}).done(function(t){n.SelectedHero(t);$("#heroDetails").modal("show");setTimeout(function(){$("#tblHeroCombos").DataTable({scrollX:!0,order:[[2,"desc"]],pagingType:"simple",dom:"<'row'<'col-sm-6'i><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'l><'col-sm-7'p>>"})},200)})}};n.SelectAbility=function(t){if(n.SelectedDraft().length==12){var i=$.map(n.AvailableAbilities(),function(n){return n.id});$.post("/Draft/GetAbilityDetails/"+t.id,{abilities:i}).done(function(t){n.SelectedAbility(t);$("#abilityDetails").modal("show");setTimeout(function(){$("#tblAbilityCombos").DataTable({scrollX:!0,order:[[2,"desc"]],pagingType:"simple",dom:"<'row'<'col-sm-6'i><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'l><'col-sm-7'p>>"})},200)})}};n.Reset=function(){window.location.reload()};n.Load=function(){$.get("/Draft/GetDraftPool",function(t){var i,r;n.AvailableDraft(t);i=url("?key");i&&(r=url("?key").split(","),$.each(r,function(t,i){var u=parseInt(i),r=ko.utils.arrayFirst(n.AvailableDraft(),function(n){return n.id===u});r&&n.SelectDraft(r)}))})};n.Load()}$(document).ready(function(){var n=new DraftingViewModel;ko.applyBindings(n)});